<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<meta charset="utf-8">
<head th:include="include :: header"></head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-broad-add">
        <h4 class="form-header h4">基本信息</h4>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>所属分组：</label>
                    <div class="col-sm-8">
                        <div class="input-group">
                            <input class="form-control" type="text" id="aid" onclick="selectAidTree()"
                                   readonly="true" name="aid" value="">
                            <span class="input-group-addon"><i class="fa fa-search"></i></span>
                        </div>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>所属用户：</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="userinfo" name="userid">
                            <option value="">--请选择权限人--</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>终端类型 ：</label>
                    <div class="col-sm-8">

                        <select class="form-control" id="terminaltype" name="terminaltype">
                            <option value="1">应急广播终端</option>
                            <option value="2">后备能源型终端</option>
                            <option value="3">发射机型终端</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>IMEI号：</label>
                    <div class="col-sm-8">
                        <input id="tid" name="tid" class="form-control" required type="text"  maxlength="15" minlength="15" placeholder="请输入15位IMEI号">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">终端设备名称：</label>
                    <div class="col-sm-8">
                        <input id="tname" name="tname" class="form-control" type="text" required placeholder="请输入终端设备名称">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">终端交互时间：</label>
                    <div class="col-sm-8">
                        <input id="intertime" name="intertime" class="form-control" type="time" value="23:00:00" placeholder="请输入交互时间">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">终端手机号码：</label>
                    <div class="col-sm-8">
                        <input  class="form-control" type="text" id="phone" name="phone" minlength="11" maxlength="13" required placeholder="请输入终端手机号码">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">年维护经费：</label>
                    <div class="col-sm-8">
                        <input id="MaintenanceFunds" name="MaintenanceFunds" class="form-control" type="text" required placeholder="请输入年维护经费">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">

            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>是否启用：</label>
                    <div class="col-sm-8">
                        <div class="onoffswitch">
                            <input type="checkbox" class="onoffswitch-checkbox" id="dflag1" name="dflag1"
                                   onclick="changevalue2();"/>
                            <label class="onoffswitch-label" for="dflag1">
                                <span class="onoffswitch-inner"></span>
                                <span class="onoffswitch-switch"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <input id="isuse" name="isuse" value="false" class="form-control" type="hidden">
            </div>
            <div class="col-sm-6">


                <!--<div class="form-group">-->
                <!--<label class="col-sm-4 control-label">图片上传：</label>-->
                <!--<div class="col-sm-8">-->
                <!--<input id="files" name="files" class="form-control" type="file" multiple>-->
                <!--</div>-->
                <!--</div>-->
                <!--<input class="form-control" id="filesnum"  name="filesnum"  type="hidden"  readonly="true">-->
                <!--&lt;!&ndash;因为文件上传功能隐藏的bug，故这文件时长、大小两个字段不能删掉&ndash;&gt;-->
                <!--<input id="flenth" name="flenth" class="form-control" type="hidden" readonly value="">-->
                <!--<input id="fsize" name="fsize" class="form-control" type="hidden"  readonly value="">-->
                <label class="col-sm-4 control-label">现场照片：</label>
                <div class="col-sm-8">
                    <input id="poscene" name="poscenepic" accept=".jpg,.png,.jpeg " class="form-control" type="file" placeholder="请输入现场照片">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">终端地址：</label>
                    <div class="col-sm-8">
                        <input id="address" name="address" class="form-control" type="text" required placeholder="请输入终端地址">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">终端授权号码：</label>
                    <div class="col-sm-8">
                        <input list="tellist" class="form-control" id="tel" name="tel" placeholder="请输入终端授权号码" required autocomplete="off"/>
                        <datalist id="tellist">
                            <option value="">--请选择终端授权号码--</option>
                        </datalist>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">出厂编号：</label>
                    <div class="col-sm-8">
                        <input id="facid" name="facid" class="form-control" required type="text" placeholder="请输入出厂编号">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">对讲接收频率：</label>
                    <div class="col-sm-8">
                        <input id="irfrequency" name="irfrequency" class="form-control" type="text" placeholder="请输入对讲接收频率">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">DCS码：</label>
                    <div class="col-sm-8">
                        <input id="dcs" name="dcs" class="form-control" required type="text" placeholder="请输入DCS码">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">广播接收频率：</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="fmfrequency" name="fmfrequency">
                            <option value="">--请输入广播接收频率--</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">管理员电话：</label>
                    <div class="col-sm-8">
                        <input list="managertellist" class="form-control" id="managertel" name="managertel" placeholder="请输入管理员号码"/>
                        <datalist id="managertellist">
                            <option value="">--请选择管理员电话--</option>
                        </datalist>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">终端管理员 ：</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="manager" name="manager">
                            <option value="">--请选择终端管理员--</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <hr/>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">基站编码：</label>
                    <div class="col-sm-8">
                        <input id="basestation" name="basestation" class="form-control" required type="text" placeholder="请输入基站编码">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">终端音量：</label>
                    <div class="col-sm-8">
                        <input id="eovolume" name="eovolume" class="form-control" type="text" required placeholder="请输入终端音量"  disabled>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">RDS：</label>
                    <div class="col-sm-8">
                        <input id="rds" name="rds" class="form-control" type="text" required placeholder="请输入3位RDS" minlength="3" maxlength="3" disabled>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">发射频率：</label>
                    <div class="col-sm-8">
                        <input id="transmitfrequency" name="transmitfrequency" class="form-control" required type="text" placeholder="请输入发射频率" disabled>
                    </div>
                </div>
            </div>
        </div>
        <!--<div class="row">-->
        <!--<div class="col-sm-6">-->
        <!--<div class="form-group">-->
        <!--<label class="col-sm-4 control-label">创建时间：</label>-->
        <!--<div class="col-sm-8">-->
        <!--<input class="form-control laydate-icon  layer-date"-->
        <!--name="createtime"-->
        <!--id="createtime"-->
        <!--value=""-->
        <!--readonly="readonly"-->
        <!--style="width:120px;"-->
        <!--placeholder="创建时间"-->
        <!--title="创建时间"/>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <h4 class="form-header h4">其他信息</h4>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">最后访问时间：</label>
                    <div class="col-sm-8">
                        <input class="form-control laydate-icon  layer-date"
                               name="lastaccesstime"
                               id="lastaccesstime"
                               value=""
                               readonly="readonly"
                               style="width:120px;"
                               placeholder="最后访问时间"
                               title="最后访问时间"/>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">年耗电量：</label>
                    <div class="col-sm-8">
                        <input id="ypowerconsumption" name="ypowerconsumption" required class="form-control" type="text" placeholder="请输入年耗电量">
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <div class="form-group">
                    <label class="col-xs-2 control-label">备注：</label>
                    <div class="col-xs-10">
                        <textarea name="note" maxlength="500" class="form-control" rows="3"></textarea>
                    </div>
                </div>
            </div>
        </div>

    </form>
</div>


<div th:include="include::footer"></div>
<script>
    $(document).ready(function(){Dropzone.options.myAwesomeDropzone={autoProcessQueue:false,uploadMultiple:true,parallelUploads:100,maxFiles:100,init:function(){var myDropzone=this;this.element.querySelector("button[type=submit]").addEventListener("click",function(e){e.preventDefault();e.stopPropagation();myDropzone.processQueue()});this.on("sendingmultiple",function(){});this.on("successmultiple",function(files,response){});this.on("errormultiple",function(files,response){})}}});
</script>
<script th:src="@{/js/plugins/dropzone/dropzone.js}"></script>
<script th:src="@{/js/jquery-form.js}"></script>
<script th:src="@{/js/plugins/layer/laydate/laydate.js}"></script>
<script th:src="@{/js/plugins/layer/layui-v2.4.5/layui/layui.js}"></script>
<script type="text/javascript">
    var prefix = ctx + "iot/broad";
    // 新增特殊分组弹窗人员下拉框调取人员信息组件
    $(function getUserInfo(ele,msg) {
        $.get("/broad/dto/userinfos",function getmsg(params1,params2) {
            for (var index = 0; index < params1.length; index++) {
                var text = params1[index].uname;
                var value = params1[index].userid;
                var phonenumber = params1[index].phonenumber
                $("#userinfo").append("<option value='"+value+"'>"+text+"</option>")
                $("#manager").append("<option value='"+text+"'>"+text+"</option>")
                $("#managertellist").append("<option>"+phonenumber+"</option>")
            }
        });
    })

    $(function getUserInfo(ele,msg) {
        $.post("/system/phonemanage/list",function getmsg(params1) {
            for (var index = 0; index < params1.rows.length; index++) {
                var uname = params1.rows[index].uname
                var phonenumber = params1.rows[index].phone
                $("#tellist").append("<option title='"+uname+"'>"+phonenumber+"</option>")
            }
        });
    })
    // 获取广播接收频率组件
    $(function getfmfrequency(ele,msg) {
        $.post("/broad/proChamanage/list",function getmsg(params1,params2) {
            var params = params1.rows;
            for (var index = 0; index < params.length; index++) {
                var text = params[index].frequencies;
                var value = params[index].frequencies;
                $("#fmfrequency").append("<option value='"+value+"'>"+text+"</option>")
            }
        });
    })

    /*用户管理-新增-选择用户所属区域树*/
    function selectAidTree() {
        var options = {
            title: '选择区域',
            width: "380",
            url: "/broad/organization/selectAidTree",
            callBack: doSubmitAid
        };
        $.modal.openOptions(options);
    }
    var Upload=document.getElementById("files");
    //var formData=new FormData(); //通过FormData对象可以组装一组用 [XMLHttpRequest]发送请求的键/值对,它可以更灵活方便的发送表单数据。
    Upload.onchange=function(){  //onchange在你选择完文件时触发
        var fileList=Upload.files ; //通过input的files属性获得fileList
        var filesnum = fileList.length;//获得文件数量
        $("#filesnum").val(filesnum);//用于传至后台进行处理
        for(let i=0;i<filesnum;i++)
        {
            var file=fileList[i];
            //formData.append("file"+i,file);  //key:"file"+i,value:file,然后就可以把formData post到后台了
            console.log(file.name+file.lastModifiedDate);
        }
    }

    // 检测是否选择文件，如果选择，返回文件对象;如果没选择，返回false
    function checkFile(){
        // 获取文件对象(该对象的类型是[object FileList]，其下有个length属性)
        var fileList = $('#files')[0].files;

        // 如果文件对象的length属性为0，就是没文件
        if (fileList.length === 0) {
            console.log('没选择文件');
            return false;
        };
        return fileList[0];
    };
    function aa(){
        let  file = checkFile();
        let size = file.size;
        console.log("文件大小",size);
        //获取录音时长
        let url = URL.createObjectURL(file);
        let audioElement = new Audio(url);
        let duration = audioElement.duration/60; //音频长度 视频不行
        $("#flenth").attr("value",duration);
        $("#fsize").attr("value",size);
        console.log(duration,size)
    };
    function sleep(numberMillis) {
        var now = new Date();
        var exitTime = now.getTime() + numberMillis;
        while (true) {
            now = new Date();
            if (now.getTime() > exitTime)
                return;
        }
    }
    //选择树的回调方法
    function doSubmitAid(index, layero){
        var tree = layero.find("iframe")[0].contentWindow.$._tree;
        var body = layer.getChildFrame('body', index);
        $("#aid").val(body.find('#treeId').val());
        layer.close(index);
    }
    $("#terminaltype").change(function(){
        var selected=$(this).children('option:selected').val()
        if(selected=="1" || selected=="2"){
            console.log($("#rds").attr('disabled'))
            if( !$("#rds").attr('disabled')){
                $("#rds").attr('disabled','disabled');
            }
            if( !$("#transmitfrequency").attr('disabled')){
                $("#transmitfrequency").attr('disabled','disabled');
            }
            if( !$("#eovolume").attr('disabled')){
                $("#eovolume").attr('disabled','disabled');
            }
        }else if(selected=="3"){
            if( $("#rds").attr('disabled')){
                $("#rds").removeAttr('disabled');
            }
            if( $("#transmitfrequency").attr('disabled')){
                $("#transmitfrequency").removeAttr('disabled');
            }
            if( $("#eovolume").attr('disabled')){
                $("#eovolume").removeAttr('disabled');
            }
        }
    });
    // function submitHandler() {
    //     if ($.validate.form()) {
    //         $.operate.save(prefix + "/add", $('#form-broad-add').serialize());
    //     }
    // }

    function changevalue2() {
        var dflag2 = document.getElementsByName("dflag1");
        if (dflag2.checked == true) {
            $("#isuse").val("false");
        } else {
            $("#isuse").val("true");
        }

    }
    laydate({
        elem:"#lastaccesstime",
        event:"focus"
    });
    laydate({
        elem:"#createtime",
        event:"focus"
    });
    layui.use('laydate', function(){
        var laydate = layui.laydate;
        //执行一个laydate实例
        laydate.render({
            elem:"#broad",
            type: 'time',
        });
    });
</script>
</body>
</html>
